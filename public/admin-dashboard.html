<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Admin Dashboard - Paneer House</title>
    <link rel="stylesheet" href="css/premium.css">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0/css/all.min.css">
</head>

<body>
    <!-- Mobile Header -->
    <header class="mobile-header mobile-only">
        <div class="mobile-brand"><i class="fas fa-cheese" style="color:var(--primary-gold)"></i> Paneer House</div>
        <div class="user-profile">
            <i class="fas fa-user-circle" style="font-size: 1.5rem; color: #666;"></i>
        </div>
    </header>

    <div class="dashboard-container">
        <!-- Sidebar (Desktop Only) -->
        <nav class="sidebar desktop-only">
            <div class="sidebar-brand">
                <i class="fas fa-cheese"></i> Paneer House
            </div>
            <a href="admin-dashboard.html" class="nav-link active"><i class="fas fa-home"></i> Dashboard</a>
            <a href="orders.html" class="nav-link"><i class="fas fa-shopping-cart"></i> Manage Orders</a>
            <a href="stock-financials.html" class="nav-link"><i class="fas fa-chart-line"></i> Stock & Financials</a>
            <a href="batch.html" class="nav-link"><i class="fas fa-box-open"></i> Receive Batch</a>
            <a href="delivery.html" class="nav-link"><i class="fas fa-truck"></i> Delivery Status</a>
            <div style="flex-grow: 1;"></div>
            <a href="#" onclick="logout()" class="nav-link"><i class="fas fa-sign-out-alt"></i> Logout</a>
        </nav>

        <!-- Main Content -->
        <main class="main-content">
            <div class="page-header desktop-only">
                <h1 class="welcome-text">Dashboard Overview</h1>
                <p class="date-display" id="currentDateDesktop">Monday, 1 Jan 2024</p>
            </div>

            <div class="mobile-only" style="margin-bottom: 1.5rem;">
                <h2 style="font-size: 1.5rem; margin-bottom: 0.2rem;">Good Morning, Admin</h2>
                <p class="date-display" id="currentDateMobile" style="font-size: 0.9rem;">Monday, 1 Jan 2024</p>
            </div>

            <!-- Quick Actions (Mobile Priority) -->
            <section>
                <h3 class="section-title" style="font-size: 1.1rem; border-bottom: none; margin-bottom: 1rem;">Quick
                    Actions</h3>
                <div class="quick-actions">
                    <a href="orders.html" class="action-card">
                        <i class="fas fa-plus-circle"></i>
                        <span>New Order</span>
                    </a>
                    <a href="batch.html" class="action-card" style="background: #2d1a1a;">
                        <i class="fas fa-box"></i>
                        <span>Add Batch</span>
                    </a>
                </div>
            </section>

            <!-- Key Stats (Horizontal Scroll) -->
            <section>
                <div style="display:flex; justify-content:space-between; align-items:center; margin-bottom:1rem;">
                    <h3 class="section-title" style="font-size: 1.1rem; border-bottom: none; margin-bottom: 0;">Today's
                        Overview</h3>
                    <a href="stock-financials.html"
                        style="font-size:0.8rem; color:var(--primary-gold); text-decoration:none;">View All</a>
                </div>

                <div class="stats-scroller">
                    <!-- Revenue -->
                    <div class="stat-card">
                        <div class="stat-title">Daily Revenue</div>
                        <div class="stat-value" id="dailyRevenue">₹0</div>
                        <div class="stat-subtitle">Today's Sales</div>
                    </div>
                    <!-- Stock -->
                    <div class="stat-card">
                        <div class="stat-title">Current Stock</div>
                        <div class="stat-value" id="currentStock">0 kg</div>
                        <div class="stat-subtitle">Available</div>
                    </div>
                    <!-- Orders -->
                    <div class="stat-card">
                        <div class="stat-title">Unfulfilled Orders</div>
                        <div class="stat-value" id="pendingOrders" style="color: #ffc107">0</div>
                        <div class="stat-subtitle">Pending Delivery</div>
                    </div>
                    <!-- Profit -->
                    <div class="stat-card">
                        <div class="stat-title">Daily Profit</div>
                        <div class="stat-value" id="dailyProfit" style="color: #28a745">₹0</div>
                        <div class="stat-subtitle">Net Earnings</div>
                    </div>
                </div>
            </section>

            <!-- Recent Activity Placeholder (Optional) -->
            <section style="margin-top: 2rem;">
                <h3 class="section-title" style="font-size: 1.1rem; border-bottom: none; margin-bottom: 1rem;">Recent
                    Activity</h3>
                <div
                    style="background:white; padding:1.5rem; border-radius:16px; text-align:center; color:#999; font-size:0.9rem;">
                    No recent notifications
                </div>
            </section>

        </main>
    </div>

    <!-- Bottom Navigation (Mobile Only) -->
    <nav class="bottom-nav mobile-only">
        <a href="admin-dashboard.html" class="nav-item active">
            <i class="fas fa-home"></i>
            <span>Home</span>
        </a>
        <a href="orders.html" class="nav-item">
            <i class="fas fa-shopping-bag"></i>
            <span>Orders</span>
        </a>
        <a href="stock-financials.html" class="nav-item">
            <i class="fas fa-chart-pie"></i>
            <span>Stock</span>
        </a>
        <a href="#" onclick="logout()" class="nav-item">
            <i class="fas fa-user"></i>
            <span>Profile</span>
        </a>
    </nav>

    <script>
        const logout = () => {
            localStorage.removeItem('user');
            window.location.href = 'index.html';
        };

        // Date Display
        const options = { weekday: 'long', year: 'numeric', month: 'long', day: 'numeric' };
        const dateStr = new Date().toLocaleDateString('en-IN', options);
        if (document.getElementById('currentDateDesktop')) document.getElementById('currentDateDesktop').textContent = dateStr;
        if (document.getElementById('currentDateMobile')) document.getElementById('currentDateMobile').textContent = dateStr;

        // Fetch Stats
        async function loadStats() {
            try {
                const response = await fetch('/api/dashboard/stats');
                const data = await response.json();

                // Orders
                // Note: Some IDs like 'totalOrders' were removed in mobile view to simplify
                if (document.getElementById('pendingOrders')) document.getElementById('pendingOrders').textContent = data.orders.pending_orders || 0;

                // Stock
                if (document.getElementById('currentStock')) document.getElementById('currentStock').textContent = (data.stock.current_stock || 0) + ' kg';

                // Financials
                const fins = data.financials;
                if (document.getElementById('dailyRevenue')) document.getElementById('dailyRevenue').textContent = '₹' + fins.daily_revenue.toLocaleString('en-IN');

                const profit = fins.daily_profit;
                if (document.getElementById('dailyProfit')) {
                    document.getElementById('dailyProfit').textContent = '₹' + profit.toLocaleString('en-IN');
                    if (profit < 0) {
                        document.getElementById('dailyProfit').style.color = '#ff6b6b';
                        document.getElementById('dailyProfit').textContent = '₹' + profit.toLocaleString('en-IN'); // Show negative or handle loss
                    }
                }

            } catch (err) {
                console.error("Error loading stats:", err);
            }
        }

        // Auth Check
        const user = JSON.parse(localStorage.getItem('user'));
        if (!user || user.role !== 'admin') {
            window.location.href = 'index.html';
        }

        loadStats();
    </script>
</body>

</html>